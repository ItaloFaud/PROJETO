var Magnifier=function(e,t){"use strict";var o=t||{},a=null,l={x:0,y:0,w:0,h:0,lensW:0,lensH:0,lensBgX:0,lensBgY:0,largeW:0,largeH:0,largeL:0,largeT:0,zoom:2,zoomMin:1.1,zoomMax:5,mode:"outside",largeWrapperId:void 0!==o.largeWrapper?o.largeWrapper.id||null:null,status:0,zoomAttached:!1,zoomable:void 0!==o.zoomable&&o.zoomable,onthumbenter:void 0!==o.onthumbenter?o.onthumbenter:null,onthumbmove:void 0!==o.onthumbmove?o.onthumbmove:null,onthumbleave:void 0!==o.onthumbleave?o.onthumbleave:null,onzoom:void 0!==o.onzoom?o.onzoom:null},n={t:0,l:0,x:0,y:0},s=0,r=0,m="",i=null,u=null,d=void 0!==o.zoom?o.zoom:l.zoom,h=void 0!==o.zoomMin?o.zoomMin:l.zoomMin,g=void 0!==o.zoomMax?o.zoomMax:l.zoomMax,c=o.mode||l.mode,p={},b=!1,z=0,f=function(e){var t=[],o=null,a=0,l="",n=0,s=0;if(document.getElementsByClassName)t=document.getElementsByClassName(e);else for(o=document.getElementsByTagName("*"),a=o.length,l=new RegExp("(^|\\s)"+e+"(\\s|$)"),s;n<a;n+=1)l.test(o[n].className)&&(t[s]=o[n],s+=1);return t},v=function(e){var t="",o=e.charAt(0),a=null;if("#"!==o&&"."!==o||(t=e.substr(1,e.length)),""!==t)switch(o){case"#":a=document.getElementById(t);break;case".":a=f(t)}return a},x=function(e,t){var o=document.createElement("div");o.id=t+"-lens",o.className="magnifier-loader",e.parentNode.appendChild(o)},y=function(){i.style.left=n.l+"px",i.style.top=n.t+"px",i.style.width=l.lensW+"px",i.style.height=l.lensH+"px",i.style.backgroundPosition="-"+l.lensBgX+"px -"+l.lensBgY+"px",u.style.left="-"+l.largeL+"px",u.style.top="-"+l.largeT+"px",u.style.width=l.largeW+"px",u.style.height=l.largeH+"px"},M=function(e,t,o,a){var l=v("#"+e+"-lens"),n=null;1===p[e].status?(n=document.createElement("div"),n.className="magnifier-loader-text",l.className="magnifier-loader hidden",n.appendChild(document.createTextNode("Loading...")),l.appendChild(n)):2===p[e].status&&(l.className="magnifier-lens hidden",l.childNodes[0]&&l.removeChild(l.childNodes[0]),l.style.background="url("+t.src+") no-repeat 0 0 scroll",o.id=e+"-large",o.style.width=p[e].largeW+"px",o.style.height=p[e].largeH+"px",o.className="magnifier-large hidden","inside"===p[e].mode?l.appendChild(o):a.appendChild(o)),l.style.width=p[e].lensW+"px",l.style.height=p[e].lensH+"px"},W=function(){var e=n.x-l.x,t=n.y-l.y,o=0,a=0;b=!(e<0||t<0||e>l.w||t>l.h),a=e-l.lensW/2,o=t-l.lensH/2,"inside"!==l.mode&&(e<l.lensW/2&&(a=0),t<l.lensH/2&&(o=0),e-l.w+l.lensW/2>0&&(a=l.w-(l.lensW+2)),t-l.h+l.lensH/2>0&&(o=l.h-(l.lensH+2))),n.l=Math.round(a),n.t=Math.round(o),l.lensBgX=n.l+1,l.lensBgY=n.t+1,"inside"===l.mode?(l.largeL=Math.round(e*(l.zoom-l.lensW/l.w)),l.largeT=Math.round(t*(l.zoom-l.lensH/l.h))):(l.largeL=Math.round(l.lensBgX*l.zoom*(l.largeWrapperW/l.w)),l.largeT=Math.round(l.lensBgY*l.zoom*(l.largeWrapperH/l.h)))},w=function(e){var t=e.wheelDelta>0||e.detail<0?.1:-.1,o=l.onzoom,s=1,r=0,m=0;e.preventDefault&&e.preventDefault(),e.returnValue=!1,l.zoom=Math.round(10*(l.zoom+t))/10,l.zoom>=l.zoomMax?l.zoom=l.zoomMax:l.zoom>=l.zoomMin?(l.lensW=Math.round(l.w/l.zoom),l.lensH=Math.round(l.h/l.zoom),"inside"===l.mode?(r=l.w,m=l.h):(r=l.largeWrapperW,m=l.largeWrapperH,s=l.largeWrapperW/l.w),l.largeW=Math.round(l.zoom*r),l.largeH=Math.round(l.zoom*m),W(),y(),null!==o&&o({thumb:a,lens:i,large:u,x:n.x,y:n.y,zoom:Math.round(l.zoom*s*10)/10,w:l.lensW,h:l.lensH})):l.zoom=l.zoomMin},N=function(){l=p[m],i=v("#"+m+"-lens"),2===l.status?(i.className="magnifier-lens",a.className==l.thumbCssClass&&(a.className=l.thumbCssClass+" opaque"),l.zoomAttached===!1&&(void 0!==l.zoomable&&l.zoomable===!0&&(e.attach("mousewheel",i,w),window.addEventListener&&i.addEventListener("DOMMouseScroll",function(e){w(e)})),l.zoomAttached=!0),u=v("#"+m+"-large"),u&&(u.className="magnifier-large")):1===l.status&&(i.className="magnifier-loader")},H=function(){if(l.status>0){var e=l.onthumbleave;null!==e&&e({thumb:a,lens:i,large:u,x:n.x,y:n.y}),i.className.indexOf("hidden")===-1&&(i.className+=" hidden",a.className=l.thumbCssClass,null!==u&&(u.className+=" hidden"))}},C=function(){if(r!==l.status&&N(),l.status>0){1===l.status?i.className="magnifier-loader":2===l.status&&(i.className="magnifier-lens",u&&(u.className="magnifier-large",u.style.left="-"+l.largeL+"px",u.style.top="-"+l.largeT+"px")),i.style.left=n.l+"px",i.style.top=n.t+"px",i.style.backgroundPosition="-"+l.lensBgX+"px -"+l.lensBgY+"px";var e=l.onthumbmove;null!==e&&e({thumb:a,lens:i,large:u,x:n.x,y:n.y})}r=l.status},B=function(e,t){var o=e.getBoundingClientRect(),a=0,l=0;t.x=o.left,t.y=o.top,t.w=Math.round(o.right-t.x),t.h=Math.round(o.bottom-t.y),t.lensW=Math.round(t.w/t.zoom),t.lensH=Math.round(t.h/t.zoom),"inside"===t.mode?(a=t.w,l=t.h):(a=t.largeWrapperW,l=t.largeWrapperH),t.largeW=Math.round(t.zoom*a),t.largeH=Math.round(t.zoom*l)};this.data=p,this.attach=function(e){if(void 0===e.thumb)throw{name:"Magnifier error",message:"Please set thumbnail",toString:function(){return this.name+": "+this.message}};var t=v(e.thumb),o=0;if(void 0!==t.length)for(o;o<t.length;o+=1)e.thumb=t[o],this.set(e);else e.thumb=t,this.set(e)},this.setThumb=function(e){a=e},this.set=function(t){if(void 0!==p[t.thumb.id])return a=t.thumb,!1;var o=new Image,r=new Image,b=t.thumb,f=b.id,y=null,w=null,A=v("#"+t.largeWrapper)||v("#"+b.getAttribute("data-large-img-wrapper"))||v("#"+l.largeWrapperId),E=t.zoom||b.getAttribute("data-zoom")||d,L=t.zoomMin||b.getAttribute("data-zoom-min")||h,T=t.zoomMax||b.getAttribute("data-zoom-max")||g,X=t.mode||b.getAttribute("data-mode")||c,Y=void 0!==t.onthumbenter?t.onthumbenter:l.onthumbenter,I=void 0!==t.onthumbleave?t.onthumbleave:l.onthumbleave,D=void 0!==t.onthumbmove?t.onthumbmove:l.onthumbmove,k=void 0!==t.onzoom?t.onzoom:l.onzoom;if(w=void 0===t.large?null!==t.thumb.getAttribute("data-large-img-url")?t.thumb.getAttribute("data-large-img-url"):t.thumb.src:t.large,null===A&&"inside"!==X)throw{name:"Magnifier error",message:"Please specify large image wrapper DOM element",toString:function(){return this.name+": "+this.message}};void 0!==t.zoomable?y=t.zoomable:null!==b.getAttribute("data-zoomable")?y="true"===b.getAttribute("data-zoomable"):void 0!==l.zoomable&&(y=l.zoomable),""===b.id&&(f=b.id="magnifier-item-"+s,s+=1),x(b,f),p.largeWrapper=A,p[f]={zoom:E,zoomMin:L,zoomMax:T,mode:X,zoomable:y,thumbCssClass:b.className,zoomAttached:!1,status:0,largeUrl:w,largeWrapperId:"outside"===X?A.id:null,largeWrapperW:"outside"===X?A.offsetWidth:null,largeWrapperH:"outside"===X?A.offsetHeight:null,onzoom:k,onthumbenter:Y,onthumbleave:I,onthumbmove:D},e.attach("mouseover",b,function(e,t){0!==l.status&&H(),m=t.id,a=t,N(t),B(a,l),n.x=e.clientX,n.y=e.clientY,W(),C();var o=l.onthumbenter;null!==o&&o({thumb:a,lens:i,large:u,x:n.x,y:n.y})},!1),e.attach("mousemove",b,function(e,t){z=1}),e.attach("load",o,function(){p[f].status=1,B(b,p[f]),M(f),e.attach("load",r,function(){p[f].status=2,M(f,b,r,A)}),r.src=p[f].largeUrl}),o.src=b.src},e.attach("mousemove",document,function(e){n.x=e.clientX,n.y=e.clientY,W(),b===!0?C():(0!==z&&H(),z=0)},!1),e.attach("scroll",window,function(){null!==a&&B(a,l)})};