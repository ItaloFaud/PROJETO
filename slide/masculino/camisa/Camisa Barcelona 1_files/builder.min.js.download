"use strict";!function(){function e(){try{T.dispatch(T.actionTypes.CHANGE_PERSONA_BUILDER,B)}catch(e){console.error("builder-combo.saveState",e)}}function r(){try{return parseInt(document.querySelector("[builder-slider]").offsetWidth,0)}catch(e){return console.error("builder.getStepWidth",e),0}}function t(e,r){try{var t=B.currContainerPosition+e*r;B.currContainerPosition=t,o(t)}catch(n){console.error("builder.moveContainer",n)}}function o(e){try{var r=document.querySelector("[builder-slider]");r.style.transform="translateX(-"+e+"px)"}catch(t){console.error("builder.setContainerPosition",t)}}function n(){try{B.currStep>1&&B.totalSteps>1&&(B.currStep--,t(-1,r()),d(),window.freedom.nsPubSub.pub("builder.steps.change",B.currStep),e())}catch(o){console.error("builder.handlePrevButton",o)}}function u(){try{B.steps[B.currStep]||p(B.currStep),B.steps[B.currStep]&&B.totalSteps>B.currStep&&B.totalSteps>1&&(S(B.currStep),B.eligibleWord[B.currStep]&&(B.eligibleWord[B.currStep].status=!0),c(function(){B.currStep++,t(1,r()),d(),window.freedom.nsPubSub.pub("builder.steps.change",B.currStep),e()}))}catch(o){console.error("builder.handleNextButton",o)}}function i(e){try{var r=e.pdp.persona.form.currField.value,t=e.pdp.persona.form.currField.type;B.eligibleWord[B.currStep]={status:!0,value:r,type:t}}catch(o){console.error("builder.updateCurrentWord",o)}}function c(e){try{var r=B.eligibleWord[B.currStep];if(r&&"text"!==r.type||!document.querySelector("[builder-block-words]"))e();else{var t=B.eligibleWord[B.currStep],o=t?t.value:null;if(o){var n=document.querySelector("[data-builder-country-code]").value;window.freedom.restClient.request("/block-words/api/blacklist/words/analyse?text="+o,{method:"get",type:"json",headers:{country:n},complete:function(r){r.eligible?(B.eligibleWord[B.currStep].status=!0,e()):(B.eligibleWord[B.currStep].status=!1,p(B.currStep))},error:function(){e(),B.eligibleWord[B.currStep].status=!0}})}else e()}}catch(u){e(),console.error("builder.validateWords",u)}}function l(){try{var r=document.querySelector("[steps-quantity]");r&&(B.totalSteps=parseInt(r.getAttribute("steps-quantity"),0)),e()}catch(t){console.error("builder.fillLoadedStats",t)}}function d(){try{var e=document.querySelector("[builder-btn-prev]"),r=document.querySelector("[builder-btn-next]"),t=document.querySelector("[data-builder-persona-buy-btn]");B.currStep>1?window.freedom.removeClass(e,"block"):window.freedom.addClass(e,"block"),B.totalSteps===B.currStep?(window.freedom.addClass(r,"hide"),t.style.display="inline-block",B.steps[B.currStep]&&y(!0)):(window.freedom.removeClass(r,"hide"),t.style.display="none")}catch(o){console.error("builder.handleButtonsStats",o)}}function s(){try{o(B.currContainerPosition)}catch(e){console.error("builder.restoreContainerPosition",e)}}function a(e){try{B.steps[B.currStep]=e,B.currStep===B.totalSteps&&y(e)}catch(r){console.error("builder.restoreContainerPosition",r)}}function p(e){try{var r='[data-step-number="'+e+'"]';r+="[builder-step-error]";var t="",o=T.getState(["pdp","persona","builder","builderJson","steps"]),n=o[B.currStep-1];t=B.checkedSteps[e]||n.multiOptions?window.freedom.i18n.getMessage("personalization_fields_generic_error"):window.freedom.i18n.getMessage("personalization_fields_select_error"),B.eligibleWord[B.currStep]&&!B.eligibleWord[B.currStep].status&&(t=window.freedom.i18n.getMessage("product_errors_cart_persona_not_allow"));var u=document.querySelector(r);u&&(u.innerHTML=t,document.querySelector(".mobile")&&b(e))}catch(i){console.error("builder.showStepErrorMessage",i)}}function b(e){try{var r=document.querySelector('.builder__step[data-step-number="'+e+'"]');r.scrollIntoView(!1)}catch(t){console.error("builder.scrollToMessage",t)}}function S(e){try{var r='[data-step-number="'+e+'"]';r+="[builder-step-error]";var t=document.querySelector(r);t&&(t.innerHTML="")}catch(o){console.error("builder.showStepErrorMessage",o)}}function f(e){try{B.checkedSteps[e]=!0}catch(r){console.error("builder.changeStepSelectedStatus",r)}}function m(){try{B.steps[B.currStep]||p(B.currStep),B.steps[B.currStep]&&S(B.currStep)}catch(e){console.error("builder.handleBuyButtonWrapper",e)}}function y(e){try{var r=document.querySelector("[data-builder-persona-buy-btn] .buy-button-now");r&&(e?window.freedom.removeClass(r,"buy-button-now--disabled"):window.freedom.addClass(r,"buy-button-now--disabled"))}catch(t){console.error("personalization.toggleBuyButtonStatus")}}function w(){var e=[];try{for(var r,t,o,n,u=T.getState(["pdp","persona","builder","builderJson","steps"]),i=T.getState(["pdp","persona","builder"]).totalSteps;i--;)r=i+1,n=B.steps[r],n&&(u[i].multiOptions?e=h(r):(o=document.querySelector('[builder-combo-select][builder-combo-step="'+r+'"'),t=o.value,"no-persona"!==t&&e.push({sku:t,step:r})))}catch(c){console.error("personalization.getSelectedPersonas",c)}finally{return e}}function h(e){var r=[];try{var t,o=document.querySelectorAll('[builder-input][builder-input-step="'+e+'"]'),n=document.querySelectorAll('[builder-input-slider][builder-input-step="'+e+'"]:checked'),u=[],i=T.getState(["pdp","persona","form","validFields"]),c=0;for(o=window.freedom.nodeListToArray(o),n=window.freedom.nodeListToArray(n),u=o.concat(n),c=u.length;c--;)t=u[c].getAttribute("builder-input-sku"),i[t]&&r.push({sku:t,step:e})}catch(l){console.error("personalization.getAllStepInputs",l)}finally{return r}}function v(e,r){var t=0,o="";o+="[builder-price]",o+='[builder-price-step="'+r+'"]',o+='[builder-price-sku="'+e+'"]';try{var n=document.querySelector(o);n&&(t=parseInt(n.getAttribute("builder-price"),10))}catch(u){console.error("personalization.getPersonaPrice",u)}finally{return t}}function g(){for(var e=0,r=w(),t=r.length;t--;){var o=t,n=r[o],u=v(n.sku,n.step);e+=u}return e}function P(e){try{return window.freedom.i18n.getMessage(e)}catch(r){return console.error("personalization.get.i18n.message",r),null}}function q(e){var r=P("currency_symbol"),t=String(e||"000").replace(/\B(?=(\d{2})(?!\d))/,",").replace(/\B(?=(\d{3})+(?!\d))/g,".");return r+" "+t}function _(){try{var e=document.querySelector(".builder__amount-value"),r=g();e&&(e.textContent=q(r))}catch(t){console.error("personalization.updateBuilderAmount",t)}}function C(){try{var e=document.querySelector(".builder__amount");B.currStep===B.totalSteps?window.freedom.removeClass(e,"builder__amount--hide"):window.freedom.addClass(e,"builder__amount--hide")}catch(r){console.log("personalization.handleBuilderAmountElement",r)}}function k(){if(document.querySelector(".mobile")&&!document.querySelector("[builder-touch-moviment]")){var e=navigator.userAgent,r=/iPad|iPhone|iPod/.test(e);if(r){var t=document.querySelector("[builder-container]");t&&(t.ontouchmove=function(e){e.preventDefault()})}}}function A(e){try{var r=e.changedTouches[0],t=parseInt(r.clientX,10)-B.startX;t<=-150&&!M?(u(),M=!0,W()):t>150&&!M&&(M=!0,n(),W()),e.preventDefault()}catch(o){console.error("builder.handleTouchEvent",o)}}function W(){setTimeout(function(){M=!1},500)}function E(){try{if(!document.querySelector(".mobile"))return;if(document.querySelector("[builder-touch-moviment]")){var e=document.querySelector("[builder-container]");e.addEventListener("touchstart",function(e){var r=e.changedTouches[0];B.startX=parseInt(r.clientX,10)},!1),e.addEventListener("touchmove",A,!1)}}catch(r){console.error("builder.listenTouchEvent",r)}}var B={currContainerPosition:0,currStep:1,totalSteps:1,steps:{},checkedSteps:{},startX:0,eligibleWord:{}},T=window.freedom.NsStore,M=!1;T.subscribe(T.actionTypes.CHANGE_PERSONA_BUILDER,C),T.subscribe(T.actionTypes.CHANGE_PERSONA_FORM,i),window.freedom.live("[data-builder-persona-buy-btn]","click",m),window.freedom.nsPubSub.sub("builder-combo.after.change",f),window.freedom.nsPubSub.sub("builder-combo.after.change",S),window.freedom.nsPubSub.sub("builder-combo.after.change",_),window.freedom.nsPubSub.sub("builder.builder-form.step.validate",a),window.freedom.nsPubSub.sub("builder.builder-form.step.validate",_),window.freedom.nsPubSub.sub("builder-wrapper.after.rendered",k),window.freedom.nsPubSub.sub("builder-wrapper.after.rendered",l),window.freedom.nsPubSub.sub("builder-wrapper.after.rendered",E),window.freedom.nsPubSub.sub("builder-wrapper.after.rendered",d),window.freedom.nsPubSub.sub("builder-wrapper.after.rendered",s),window.freedom.nsPubSub.sub("builder-wrapper.after.rendered",_),window.freedom.live("[builder-btn-prev]","click",n),window.freedom.live("[builder-btn-next]","click",u)}();