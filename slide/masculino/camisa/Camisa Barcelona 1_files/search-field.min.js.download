"use strict";!function(){function e(e){function t(e,t){var o=e;return o=o.toLowerCase(),o=o.trim(),t?(o=o.replace(/\s+/g,"+"),encodeURI(o)):(window.freedom.nsDiacritics.normalize(e),o=o.replace(/\s\s+/g," "))}function n(){window.clearTimeout(b.searchTimeoutId),b.searchTimeoutId=null;var t=y.querySelectorAll("[data-suggestion-list] a");if(t)for(var n=0;n<t.length;n++)t[n].removeEventListener("mouseover",w);o.pub("overlay.display","hide"),window.freedom.removeClass(e,"suggestion-active"),y.innerHTML="",b.selectedSuggestionLastPosition=-1}function s(e){n(),"string"==typeof e&&(y.innerHTML=e,m(),window.freedom.nsPubSub.pub("Searchfield.suggestion.loaded"))}function i(e){var t=y.querySelector("[data-suggestion-top-results-wrapper]");"string"==typeof e&&e&&t&&(t.innerHTML=e,window.freedom.nsPubSub.pub("Searchfield.suggestion.loaded"));var o=y.querySelector("."+T);o&&window.freedom.removeClass(o,T)}function r(e,t){t&&t.length>1&&window.freedom.restClient.request(e+"?q="+t,{complete:function(t){if(b.searchTimeoutId){if(e===P.suggestion)return void s(t);i(t)}}})}function a(e,o){return o=t(o,!0),o.toLowerCase()!==b.lastRequestedQuery.toLowerCase()&&(b.lastRequestedQuery=o,window.clearTimeout(b.searchTimeoutId),b.searchTimeoutId=window.setTimeout(function(){r(e,o)},200),!0)}function u(){var e=y.querySelector("."+L);e&&(window.freedom.removeClass(e,L),window.freedom.removeClass(e,T))}function d(e){window.freedom.addClass(e,L),a(P.topResults,e.innerText)&&window.freedom.addClass(e,T)}function l(e){window.freedom.removeClass(e.currentTarget,L),S.value=b.lastTypedQuery,S.focus()}function c(e){var t,o=y.querySelectorAll("[data-suggestion-list] a");if(o.length){switch(b.selectedSuggestionLastPosition===-1&&(b.lastTypedQuery=S.value),e.keyCode){case C.up:b.selectedSuggestionLastPosition>=0?b.selectedSuggestionLastPosition--:b.selectedSuggestionLastPosition=o.length-1;break;case C.down:b.selectedSuggestionLastPosition===o.length-1?b.selectedSuggestionLastPosition=-1:b.selectedSuggestionLastPosition++;break;default:return}if(e.preventDefault(),b.selectedSuggestionLastPosition===-1)return S.value=b.lastTypedQuery,l(e),void u();t=o[b.selectedSuggestionLastPosition],S.value=t.innerText,u(),d(t)}}function g(t){return t.value?window.freedom.addClass(e,"clear-active"):window.freedom.removeClass(e,"clear-active"),t.value.length<2?void n():void a(P.suggestion,t.value)}function f(e){var t=e.currentTarget;return e.keyCode===C.esc?(window.freedom.nsPubSub.pub("Searchfield.esc.pressed"),void n()):e.keyCode===C.up||e.keyCode===C.down?void c(e):void g(t)}function w(e){u(),a(P.topResults,e.currentTarget.innerText)&&window.freedom.addClass(e.target,T)}function v(e){setTimeout(function(){window.freedom.removeClass(e.target,T)},20)}function m(){for(var t=y.querySelectorAll("[data-suggestion-list] a"),n=0;n<t.length;n++)t[n].addEventListener("mouseover",w),t[n].addEventListener("mouseleave",v);o.pub("overlay.display","show"),window.freedom.addClass(e,"suggestion-active")}function p(e){S.value?S.value=t(S.value):(window.freedom.preventDefault(e),window.location.pathname&&"/"!==window.location.pathname&&window.location.assign("/"))}var y=e.querySelector("[data-search-suggestion-wrapper]"),S=e.querySelector("[data-search-field]"),h=e.parentElement.querySelector("[data-search-field-form]");if(!y||!S||!h)throw new Error("Main structure is missing. Verify SearchField component.");var b={lastTypedQuery:"",searchTimeoutId:null,lastRequestedQuery:"",selectedSuggestionLastPosition:-1},L="selected",T="loading",C={up:38,down:40,esc:27},P={suggestion:"/refactoring/suggestion",topResults:"/refactoring/suggestion/top-results"};!function(){var t=e.getAttribute("data-suggestion"),o=!(t&&"ENABLED"!==t);h.addEventListener("submit",p),o&&(n(),window.freedom.nsPubSub.sub("overlay.clicked",n),window.freedom.nsPubSub.sub("searchField.clearSuggestion",n),window.freedom.nsPubSub.sub("searchField.valueUpdated",g),S.addEventListener("keyup",f))}()}function t(){var t=document.querySelectorAll("[data-search-field-wrapper]");if(t.length)for(var o=0;o<t.length;o++)e(t[o])}var o=window.freedom.nsPubSub||{};!function(){o.sub("nsDiacritics.loaded",t)}()}();