"use strict";!function(){function e(){try{y.dispatch(y.actionTypes.CHANGE_PERSONA_FORM,m)}catch(e){console.error("builder-combo.saveState",e)}}function r(r){try{var u=r.target,i=u.getAttribute("builder-input-sku"),n=u.getAttribute("builder-input-step"),l=y.getState(["pdp","persona","builder","builderJson","steps"]),d=!1;l[n-1].multiOptions?(d=t(n),window.freedom.nsPubSub.pub("builder.builder-form.step.validate",d),e()):window.freedom.nsPubSub.pub("builder.builder-form.step.validate",o(i,n))}catch(a){console.error("builder.slider.validateInputByEvent",a)}}function t(e){var r=!1;try{var t,u=document.querySelectorAll('[builder-input][builder-input-step="'+e+'"]'),i=document.querySelectorAll('[builder-input-slider][builder-input-step="'+e+'"]:checked'),n=[],l=0;for(u=window.freedom.nodeListToArray(u),i=window.freedom.nodeListToArray(i),n=u.concat(i),l=n.length;l--;)t=n[l].getAttribute("builder-input-sku"),o(t,e)?(r=!0,m.validFields[t]=!0):m.validFields[t]=!1}catch(d){console.error("builder.slider.validateInputByEvent",d)}finally{return r}}function u(e){try{var r=e.target,t=r.value,u=r.getAttribute("builder-combo-step");"no-persona"===t?window.freedom.nsPubSub.pub("builder.builder-form.step.validate",!0):window.freedom.nsPubSub.pub("builder.builder-form.step.validate",o(t,u))}catch(i){console.error("builder.slider.validateInputByEvent",i)}}function o(e,r){try{var t=d(e,r);return!!t&&(!(!t.value||""===t.value.trim)&&!(t.color&&!t.color.code))}catch(u){return console.error("builder-form.getPersonaObjectByInputEl",u),!0}}function i(e,r,t){try{var u='[builder-input-step="'+e+'"]';return u+='[builder-input-sku="'+r+'"]',u+=t||""}catch(o){return console.error("builder-form.getPersonaObjectByInputEl",o),""}}function n(e){var r={};try{if(e){var t=e.getAttribute("builder-input-sku"),u=e.getAttribute("builder-input-step"),o=e.getAttribute("builder-input-image"),i=l(t,u);r.sku=t,r.value=e.value,o&&(r.imageValue=o),i&&(r.color=i)}}catch(n){console.error("builder-form.getPersonaObjectByInputEl",n)}finally{return r}}function l(e,r){var t={};try{var u,o=i(r,e,'[builder-input-attribute="color"]:checked'),n=i(r,e,'[builder-input-attribute="color"]'),l=!!document.querySelector(n);l?(u=document.querySelector(o),u&&(t.code=u.value,t.hexa=u.getAttribute("builder-input-color-hexa"),t.name=u.getAttribute("builder-input-color-name"))):t=null}catch(d){console.error("builder-form.getPersonaColor",d)}finally{return t}}function d(r,t){var u=null;try{var o=i(t,r),l=document.querySelector(o),d=l?l.type:"";switch(d){case"radio":o=i(t,r,":checked"),u=n(document.querySelector(o)),m.currField=Object.assign({},u,{type:"radio"}),e();break;case"text":u=n(l),m.currField=Object.assign({},u,{type:"text"}),e()}}catch(a){console.error("builder-form.getPersonaValue",a)}finally{return u}}function a(e){var r=[];try{if(f.personaOpened)for(var t,u,o,i,n,l=y.getState(["pdp","persona","builder","builderJson","steps"]),a=y.getState(["pdp","persona","builder"]).totalSteps;a--;)u=a+1,l[a].multiOptions?r=c(u):(n=document.querySelector('[builder-combo-select][builder-combo-step="'+u+'"'),u=n.getAttribute("builder-combo-step"),o=n.value,t=d(o,u),i=s(u),t&&(Object.assign(t,i),r.push(t)))}catch(b){console.error("builder-form.getPersonaList",b)}finally{return e&&e(r,!0),r}}function c(e){var r=[];try{var t,u,o,i=document.querySelectorAll('[builder-input][builder-input-step="'+e+'"]'),n=document.querySelectorAll('[builder-input-slider][builder-input-step="'+e+'"]:checked'),l=[],a=0,c="";for(i=window.freedom.nodeListToArray(i),n=window.freedom.nodeListToArray(n),l=i.concat(n),a=l.length;a--;)t=l[a].getAttribute("builder-input-sku"),c=l[a].getAttribute("builder-input-name"),u=d(t,e),o=s(e),u&&""!==u.value.trim()&&(Object.assign(u,o,{label:c}),r.push(u))}catch(b){console.error("builder-form.getMultOptionsPersonaList",b)}finally{return r}}function s(e){var r={};try{var t=y.getState().pdp.persona.builder.builderJson,u=t.steps[e-1];u&&(r.cartImage=u.cartImage,r.productType=u.productType,r.label=u.label)}catch(o){console.error("builder-form.getPersonaList",o)}finally{return r}}function b(e){try{f.personaOpened=e}catch(r){console.error("builder-form.changePersonaOpenStatus",r)}}function p(){try{if(f.personaOpened){var e={list:a(),state:f.personaOpened};y.dispatch(y.actionTypes.CHANGE_SELECTED_PERSONA_BUILDER,e)}else y.dispatch(y.actionTypes.CHANGE_SELECTED_PERSONA_BUILDER,{})}catch(r){console.error("builder-combo.saveState",r)}}var f={personaOpened:!1},m={currField:"",validFields:{}},y=window.freedom.NsStore;window.freedom.nsPubSub.sub("colorFlavorSize.size.buyEvent",p),window.freedom.nsPubSub.sub("personalization.form.changeOpenClosed",b),window.freedom.nsPubSub.sub("builder.builder-combo.changed",u),window.freedom.nsPubSub.sub("builder.color-radio.changed",r),window.freedom.nsPubSub.sub("builder.slider.changed",r),window.freedom.nsPubSub.sub("builder.input.inputed",r),window.freedom.nsPubSub.sub("builder.personalization.get",a)}();