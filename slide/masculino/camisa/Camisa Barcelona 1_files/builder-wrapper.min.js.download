"use strict";!function(){function e(){try{var e=document.querySelector("[data-builder-downloaded]").value,r=JSON.parse(e),o={builderJson:r};p.dispatch(p.actionTypes.CHANGE_PERSONA_BUILDER,o)}catch(n){console.error("builder-combo.saveState",n)}}function r(){var e=null;try{e=document.querySelector("[builder-wrapper-target]")}catch(r){console.error("builder-wrapper.getTarget",r)}finally{return e}}function o(o){try{window.freedom.nsPubSub.pub("builder-wrapper.before.rendered",{});var t=r();t.innerHTML=o,b.builderOnTheDom=!0,e(),n(),window.freedom.nsPubSub.pub("callToAction.hide.main-button",!0),window.freedom.nsPubSub.pub("builder-wrapper.after.rendered",{}),window.freedom.nsPubSub.pub("modal.restart"),window.freedom.nsPubSub.pub("SlidePush.restart","personalization-page-preview")}catch(u){console.error("builder-wrapper.insertIntoDom",u),b.builderOnTheDom=!1,window.freedom.nsPubSub.pub("callToAction.hide.main-button",!1)}}function n(){try{var e=p.getState(["pdp","persona","builder","builderJson","steps"]),r=e?e[0]:null;r&&r.multiOptions&&window.freedom.nsPubSub.pub("builder-wrapper.open.multi-options",{})}catch(o){console.error("builder-wrapper.notifyMultiOptions",o)}}function t(e){try{var r=document.querySelector("[builder-wrapper-image-preview]"),o=r?r.value:null,n=document.querySelector("[data-product-sku]").getAttribute("data-product-sku"),t=document.querySelector("[product-data-seller]").getAttribute("product-data-seller");window.freedom.restClient.request("/personalization/get-builder",{method:"post",data:{image:o,sku:n,sellerId:t},complete:e})}catch(u){console.error("builder-wrapper.getBuilder",u)}}function u(){try{b.builderOnTheDom=!!document.querySelector("[builder-container]")}catch(e){console.error("builder-wrapper.fetchBuilderOnTheDom",e)}}function i(){try{u(),!r()||b.builderOnTheDom||b.fetching||(b.fetching=!0,c("show"),t(function(e){b.fetching=!1,c("hide"),"string"==typeof e&&o(e)}))}catch(e){console.error("builder-wrapper.render",e)}}function d(){try{s.open&&i()}catch(e){console.error("builder-wrapper.renderOnLoad",e)}}function a(){try{b.builderOnTheDom=!1}catch(e){console.error("builder-wrapper.setBuilderNoVisible",e)}}function l(e){try{e&&b.builderOnTheDom?window.freedom.nsPubSub.pub("callToAction.hide.main-button",!0):window.freedom.nsPubSub.pub("callToAction.hide.main-button",!1),s.open=e}catch(r){console.error("builder-wrapper.handlePersonaState",r)}}function c(e){try{var r=document.querySelector("[builder-wrapper-loader]");r&&window.freedom.nsPubSub.pub("spin.loading.animate",r,e)}catch(o){console.error("builder-wrapper.handlePersonaState",o)}}var b={builderOnTheDom:!1,fetching:!1},p=window.freedom.NsStore,s={open:!1};window.freedom.nsPubSub.sub("personalization.open.after",i),window.freedom.nsPubSub.sub("personalization.form.changeOpenClosed",l),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.before",a),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.after",d)}();